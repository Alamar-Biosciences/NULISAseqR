% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_heatmap.R
\name{generate_heatmap}
\alias{generate_heatmap}
\title{Generate Heatmap for NULISAseq Data with ComplexHeatmap}
\usage{
generate_heatmap(
  data,
  sampleInfo,
  targetInfo = NULL,
  sampleName_var,
  targetName_var = "Target",
  sample_subset = NULL,
  target_subset = NULL,
  annotate_sample_by = NULL,
  annotate_target_by = NULL,
  column_split_by = NULL,
  row_split_by = NULL,
  row_fontsize = 4,
  col_fontsize = 4,
  column_split_num = NULL,
  name = "Z-Score",
  row_title_rot = 0,
  clustering_method_columns = "ward.D2",
  row_split = NULL,
  cluster_rows = TRUE,
  cluster_column_slices = FALSE,
  cluster_row_slices = TRUE,
  transpose = FALSE,
  numeric_color_palette = c("blue", "red", "green", "purple", "orange", "brown"),
  sample_colors = NULL,
  output_dir = NULL,
  plot_name = NULL,
  plot_title = NULL,
  plot_width = 14,
  plot_height = 7,
  ...
)
}
\arguments{
\item{data}{A matrix with targets in rows, samples in columns. 
Row names should be the target names, and column names are the sample names.
It is assumed that data has already been transformed using \code{log2(x + 1)} 
for each NULISAseq normalized count value \code{x}, i.e. NPQ.}

\item{sampleInfo}{A data frame with sample metadata. Rows are samples, 
columns are sample metadata variables. Heatmap will only show the samples in 
\code{sample_subset} from \code{sampleInfo}.}

\item{targetInfo}{A data frame with target metadata. Rows are targets,
columns are target metadata variables. Required if \code{annotate_target_by} 
or \code{row_split_by} are specified; defaults to \code{NULL}.}

\item{sampleName_var}{Character string specifying the name of the column in \code{sampleInfo} 
that matches the column names of \code{data}. This variable will be used for subsetting 
samples from \code{sampleInfo}.}

\item{targetName_var}{Character string specifying the name of the column in \code{targetInfo}
that matches the row names of \code{data}; defaults to \code{"Target"}.}

\item{sample_subset}{Vector of sample names for selected samples to show in the heatmap, 
should match the existing column names of \code{data}; defaults to \code{NULL} (all samples).}

\item{target_subset}{Vector of target names for selected targets to show in the heatmap, 
should match the existing row names of \code{data}; defaults to \code{NULL} (all targets).}

\item{annotate_sample_by}{Character vector of column names from \code{sampleInfo} that will
be used for sample annotations (shown as colored bars); defaults to \code{NULL}.}

\item{annotate_target_by}{Character vector of column names from \code{targetInfo} that will
be used for target annotations (shown as colored bars on the left or top depending on orientation); 
defaults to \code{NULL}.}

\item{column_split_by}{Character string specifying the name of the column from \code{sampleInfo} 
that will be used for supervised clustering of columns (samples). This creates separate column 
slices in the heatmap; defaults to \code{NULL}.}

\item{row_split_by}{Character string specifying the name of the column from \code{targetInfo} 
that will be used for supervised clustering of rows (targets). This creates separate row 
slices in the heatmap; defaults to \code{NULL}.}

\item{row_fontsize}{Numeric value for the text size of the row labels in heatmap; 
defaults to 4.}

\item{col_fontsize}{Numeric value for the text size of the column labels in heatmap; 
defaults to 4.}

\item{column_split_num}{Integer specifying the number of slices that the columns are split into
via unsupervised clustering; defaults to \code{NULL}. Ignored if \code{column_split_by} is specified.}

\item{name}{Character string used as the title of the heatmap legend; 
defaults to \code{"Z-Score"}.}

\item{row_title_rot}{Numeric value for rotation of row titles in degrees. 
Only 0, 90, 270 are allowed; defaults to 0.}

\item{clustering_method_columns}{Character string specifying the method to perform 
hierarchical clustering, passed to \code{hclust}; defaults to \code{"ward.D2"}.}

\item{row_split}{Integer specifying the number of slices that the rows are split into
via unsupervised clustering; defaults to \code{NULL}. Ignored if \code{row_split_by} is specified.
When \code{NULL} and \code{targetInfo} is not provided, no row splitting is performed.}

\item{cluster_rows}{Logical indicating whether to cluster rows (targets). If \code{NULL} (default),
clustering is enabled when \code{targetInfo} is provided, and disabled when \code{targetInfo} is \code{NULL}.}

\item{cluster_column_slices}{Logical indicating whether to perform clustering on column slices 
if columns are split; defaults to \code{FALSE}.}

\item{cluster_row_slices}{Logical indicating whether to perform clustering on row slices
if rows are split; defaults to \code{TRUE}.}

\item{transpose}{Logical indicating whether to transpose the heatmap (samples in rows, 
targets in columns); defaults to \code{FALSE}.}

\item{numeric_color_palette}{Character vector of colors to use for numeric annotations.
Each color will be used with a white-to-color gradient for continuous variables;
defaults to \code{c("blue", "red", "green", "purple", "orange", "brown")}.}

\item{sample_colors}{Named list of custom colors for categorical sample annotations.
List names should match column names in \code{annotate_sample_by}. Each element should be
a named vector where names are category levels and values are color codes; defaults to \code{NULL}.}

\item{output_dir}{Character string specifying the directory path to save the plot. 
If \code{NULL}, the plot is not saved; defaults to \code{NULL}.}

\item{plot_name}{Character string specifying the filename for the saved plot, 
including file extension (.pdf, .png, .jpg, or .svg). Required if \code{output_dir} is specified; 
defaults to \code{NULL}.}

\item{plot_title}{Character string for the title of the heatmap; defaults to \code{NULL}.}

\item{plot_width}{Numeric value for the width of the saved plot in inches; defaults to 14.}

\item{plot_height}{Numeric value for the height of the saved plot in inches; defaults to 7.}

\item{...}{Additional arguments passed to \code{ComplexHeatmap::Heatmap} function.}
}
\value{
A list containing:
\describe{
  \item{targets_used}{Character vector of target names used in the heatmap after filtering.}
  \item{heatmap}{The ComplexHeatmap object.}
}
}
\description{
Draws a heatmap for a set of samples and targets based on sample and target metadata. 
Uses ComplexHeatmap for generating plots. Colors of covariates are automatically generated 
from palettes in RColorBrewer, or can be user-specified. Supports both standard and transposed 
orientations, row and column annotations, and various clustering options.
}
\details{
The function performs the following steps:
\enumerate{
  \item Filters data to specified samples and targets
  \item Removes targets with all zero values
  \item Scales data by row (Z-score transformation)
  \item Removes rows with NA, NaN, or Inf values after scaling
  \item Optionally transposes the matrix
  \item Generates or uses custom colors for annotations
  \item Creates the heatmap with specified annotations and clustering
  \item Optionally saves to file
}
}
\section{Custom Colors}{

To specify custom colors for categorical sample annotations, use the \code{sample_colors} parameter:
\preformatted{
my_colors <- list(
  Group = c("Control" = "#FF0000", "Treatment" = "#0000FF"),
  Batch = c("Batch1" = "#FFA500", "Batch2" = "#800080")
)
}
}

\examples{
\dontrun{
# Basic heatmap with sample annotations (no row clustering by default)
result <- generate_heatmap(
  data = Data_NPQ,
  sampleInfo = sample_metadata,
  sampleName_var = "SampleName",
  annotate_sample_by = c("Group", "Batch")
)

# Heatmap with row clustering enabled
result <- generate_heatmap(
  data = Data_NPQ,
  sampleInfo = sample_metadata,
  sampleName_var = "SampleName",
  annotate_sample_by = c("Group", "Batch"),
  cluster_rows = TRUE,
  row_split = 3
)

# Heatmap with target annotations and custom colors
custom_colors <- list(
  Group = c("Control" = "blue", "Treatment" = "red")
)

result <- generate_heatmap(
  data = Data_NPQ,
  sampleInfo = sample_metadata,
  targetInfo = target_metadata,
  sampleName_var = "SampleName",
  targetName_var = "Target",
  annotate_sample_by = c("Group", "Batch"),
  annotate_target_by = c("Pathway", "Domain"),
  sample_colors = custom_colors,
  row_split_by = "Pathway",
  column_split_by = "Group"
)

# Save heatmap to file (supports PDF, PNG, JPG, SVG)
result <- generate_heatmap(
  data = expr_matrix,
  sampleInfo = sample_metadata,
  sampleName_var = "Sample_ID",
  annotate_sample_by = c("Group"),
  output_dir = "output/figures",
  plot_name = "expression_heatmap.svg",
  plot_title = "Gene Expression Heatmap",
  plot_width = 12,
  plot_height = 8
)
}
}
