% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/generate_pca.R
\name{generate_pca}
\alias{generate_pca}
\title{Generate PCA Biplot for NULISAseq Data with PCAtools}
\usage{
generate_pca(
  data,
  sampleInfo,
  sampleName_var,
  annotate_sample_by = NULL,
  label_points = FALSE,
  sample_subset = NULL,
  target_subset = NULL,
  shape_by = NULL,
  encircle = TRUE,
  encircleFill = TRUE,
  sample_colors = NULL,
  output_dir = NULL,
  plot_name = NULL,
  plot_title = NULL,
  plot_width = 10,
  plot_height = 8,
  ...
)
}
\arguments{
\item{data}{A matrix with targets in rows, samples in columns. 
Row names should be the target names, and column names are the sample names.
It is assumed that data has already been transformed using \code{log2(x + 1)} 
for each NULISAseq normalized count value \code{x}, i.e. NPQ.}

\item{sampleInfo}{A data frame with sample metadata. Rows are samples, 
columns are sample metadata variables.}

\item{sampleName_var}{Character string specifying the name of the column in \code{sampleInfo} 
that matches the column names of \code{data}.}

\item{annotate_sample_by}{Character string specifying the column name from \code{sampleInfo}
to use for coloring points. Only one variable is allowed; defaults to \code{NULL}.}

\item{label_points}{Logical indicating whether to add sample labels to the plot;
defaults to \code{FALSE}.}

\item{sample_subset}{Vector of sample names for selected samples to include in PCA, 
should match the existing column names of \code{data}; defaults to \code{NULL} (all samples).}

\item{target_subset}{Vector of target names for selected targets to include in PCA, 
should match the existing row names of \code{data}; defaults to \code{NULL} (all targets).}

\item{shape_by}{Character string specifying the column name from \code{sampleInfo}
to use for point shapes; defaults to \code{NULL}.}

\item{encircle}{Logical indicating whether to draw ellipses around groups;
defaults to \code{TRUE}.}

\item{encircleFill}{Logical indicating whether to fill the ellipses;
defaults to \code{TRUE}.}

\item{sample_colors}{Named vector of custom colors for sample groups.
Names should match the levels in \code{annotate_sample_by}; defaults to \code{NULL}.}

\item{output_dir}{Character string specifying the directory path to save the plot. 
If \code{NULL}, the plot is not saved; defaults to \code{NULL}. If provided without
\code{plot_name}, a default filename with timestamp will be generated.}

\item{plot_name}{Character string specifying the filename for the saved plot, 
including file extension (.pdf, .png, .jpg, or .svg). If \code{NULL} and \code{output_dir}
is provided, a default filename with timestamp will be used; defaults to \code{NULL}.}

\item{plot_title}{Character string for the title of the PCA plot; defaults to \code{NULL}.}

\item{plot_width}{Numeric value for the width of the saved plot in inches; defaults to 10.}

\item{plot_height}{Numeric value for the height of the saved plot in inches; defaults to 8.}

\item{...}{Additional arguments passed to \code{PCAtools::biplot} function.}
}
\value{
A list containing:
\describe{
  \item{targets_used}{Character vector of target names used in the PCA after filtering.}
  \item{pca_results}{The PCAtools PCA object containing all PCA results.}
  \item{rotated}{Data frame containing the PC scores (PC1, PC2, etc.) for each sample.}
  \item{plot}{The ggplot2 object of the PCA biplot.}
  \item{output_path}{Character string of the full path to the saved file, or \code{NULL} if not saved.}
}
}
\description{
Performs Principal Component Analysis (PCA) and generates a biplot for visualizing
sample relationships based on gene expression data. Uses PCAtools for analysis
and ggplot2 for visualization. Colors are automatically generated from RColorBrewer
palettes.
}
\details{
The function performs the following steps:
\enumerate{
  \item Filters data to specified samples and targets
  \item Removes targets with all zero values
  \item Scales data by row (Z-score transformation)
  \item Removes rows with NA, NaN, or Inf values after scaling
  \item Performs PCA using PCAtools
  \item Generates biplot with specified aesthetics
  \item Optionally saves to file
}
}
\section{Custom Colors}{

To specify custom colors for sample groups, use the \code{sample_colors} parameter:
\preformatted{
my_colors <- c("Control" = "#FF0000", "Treatment" = "#0000FF")
}
}

\examples{
\dontrun{
# Basic PCA plot
result <- generate_pca(
  data = Data_NPQ,
  sampleInfo = sample_metadata,
  sampleName_var = "SampleName",
  annotate_sample_by = "Group"
)

# PCA with sample labels and custom shapes
result <- generate_pca(
  data = Data_NPQ,
  sampleInfo = sample_metadata,
  sampleName_var = "SampleName",
  annotate_sample_by = "Group",
  shape_by = "Batch",
  label_points = TRUE
)

# PCA with custom colors
custom_colors <- c("Control" = "blue", "Treatment" = "red")
result <- generate_pca(
  data = Data_NPQ,
  sampleInfo = sample_metadata,
  sampleName_var = "SampleName",
  annotate_sample_by = "Group",
  sample_colors = custom_colors
)

# Save PCA plot to file
result <- generate_pca(
  data = Data_NPQ,
  sampleInfo = sample_metadata,
  sampleName_var = "SampleName",
  annotate_sample_by = "Group",
  output_dir = "output/figures",
  plot_name = "pca_analysis.pdf",
  plot_title = "PCA Analysis of Expression Data",
  plot_width = 12,
  plot_height = 10
)
}

}
